

### 进程和线程之间有什么区别？

#### 相同点

- Linux 操作系统下，进程与线程均为内核调度实体，并且进程和线程的创建均使用 `do_fork()` 系统调用实现。


#### 不同点

- 进程是资源分配的最小单位，而线程则是系统调度的最小单位。简单的来说，诸如 CPU、内存等资源，我们只能够在进程的粒度上进行限制，无法在线程的粒度上限制资源使用，Linux 下特有的 /proc/PID 中就是对进程资源的限制，又比如 Docker 创建的容器也是对隔离的进程进行资源限制。当一个进程在运行时，一定会有一个线程来执行程序代码，通常称之为 main 线程。
- 进程下多个线程间共享虚拟内存、文件描述符、信号处理方式等资源，但进程间拥有独立的虚拟内存、文件描述符与信号处理等资源。在创建线程时，由于虚拟内存、文件描述符等资源共享，故不需要进行额外的内存复制。当创建进程时，OS 使用 Copy-On-Write 的方式延迟对内存内容的复制，但仍需要一些额外的开销。因此，尽管子进程可能在创建后立即调用 `exec()` 执行新的程序，其创建速度依然慢于线程的创建速度。
- 通信方式不同。线程间可通过全局变量、互斥锁或者是条件变量来进行通信，但进程间只能使用管道、OS 提供的共享内存等进行通信，需要投入更多的资源。
- 对信号的支持不同。由于线程是“依附”在进程之上的，因此，同一个进程下的多个线程在使用信号时会有问题，无法准确的将信号传递至某一个具体的线程，例如 Python 中的信号不支持在多线程环境中使用。而对于进程而言，我们可通过 `kill()` 或者是 `raise()` 的方式将信号传递给具体的进程，不管它是父进程还是子进程。
- 上下文切换速度不同。因为线程间共享了虚拟内存、文件描述符等诸多信息，因此 OS 只需要在上下文保存线程的堆栈、寄存器等少量信息，所以其切换速度要高于进程间的上下文切换。
